<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MangaForgeFree - AI Manga Generator</title>
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

    <!-- ‚úÖ SEO & Open Graph Meta Tags -->
    <meta name="description" content="Generate AI-powered manga panels for free! Create characters, write a story, and bring your manga to life.">
    <meta name="keywords" content="AI manga generator, manga AI, create manga, AI art, manga creator">
    <meta name="author" content="MangaForgeFree">
    <meta property="og:title" content="MangaForgeFree - AI Manga Generator">
    <meta property="og:description" content="Generate AI-powered manga panels for free! Create characters, write a story, and bring your manga to life.">
    <meta property="og:image" content="{{ url_for('static', filename='banner.jpg') }}">
    <meta property="og:url" content="https://your-website.com">
    <meta name="twitter:card" content="summary_large_image">
</head>
<body>

    <!-- ‚úÖ Header with Logo -->
    <header>
        <img src="{{ url_for('static', filename='logo.jpeg') }}" alt="MangaForgeFree Logo" class="logo">
        <h1>üé® Welcome to MangaForgeFree üé®</h1>
        <p>Create AI-generated manga panels with your own characters!</p>
    </header>

    <!-- ‚úÖ Create Character Button -->
    <section class="center">
        <a href="/c_character"><button>Create a Character</button></a>
    </section>

    <!-- ‚úÖ Story Prompt Form -->
    <section class="script-box">
        <h2>Write a Story & Generate Manga</h2>
        <form id="mangaForm">
            <textarea id="story_prompt" name="story_prompt" placeholder="Write your story here, referencing characters by name..." required></textarea>
            <br>
            <label for="reference_image">Upload Reference Image (Optional):</label>
            <input type="file" id="reference_image" name="reference_image" accept="image/*">
            <br>
            <button type="submit">Generate Manga</button>
        </form>
        <p id="loadingMessage">‚è≥ Generating... Please wait.</p>
    </section>

    <!-- ‚úÖ Generated Manga Section -->
    <section id="generatedManga">
        <h2>Generated Manga Panel</h2>
        <p>üéâ Your manga will appear here after generation!</p>
    </section>

    <!-- ‚úÖ Character Library -->
    <section>
        <h2>Character Library</h2>
        <div class="character-container">
            {% if characters %}
                {% for key, character in characters.items() %}
                    <div class="character-card">
                        <img src="{{ character.profile_pic }}" alt="Profile Picture">
                        <p><strong>{{ character.name }}</strong></p>
                        <p>{{ character.appearance }}, {{ character.traits }}</p>

                        <!-- Generate Manga Form -->
                        <form class="generate-manga-form">
                            <input type="hidden" name="character_key" value="{{ key }}">
                            <input type="text" name="story_prompt" placeholder="Describe the scene..." required>
                            <input type="submit" value="Generate Manga">
                        </form>

                        <!-- Delete Character Form -->
                        <form action="/delete_character" method="POST" onsubmit="return confirm('Are you sure you want to delete this character?');">
                            <input type="hidden" name="character_key" value="{{ key }}">
                            <button type="submit" class="delete-btn">Delete</button>
                        </form>
                    </div>
                {% endfor %}
            {% else %}
                <p>No characters created yet.</p>
            {% endif %}
        </div>
    </section>

    <!-- ‚úÖ JavaScript for AJAX -->
    <script>
        document.getElementById("mangaForm").addEventListener("submit", function(event) {
            event.preventDefault();
            let formData = new FormData(this);
            let request = new XMLHttpRequest();
            request.open("POST", "/generate_manga", true);
            document.getElementById("loadingMessage").style.display = "block";

            request.onreadystatechange = function () {
                if (request.readyState == 4) {
                    document.getElementById("loadingMessage").style.display = "none";
                    if (request.status == 200) {
                        let response = JSON.parse(request.responseText);
                        document.getElementById("generatedManga").innerHTML = "<img src='" + response.manga_image + "' alt='Generated Manga'>";
                    } else {
                        document.getElementById("generatedManga").innerHTML = "<p style='color: red;'>‚ö†Ô∏è Error generating manga. Please try again.</p>";
                    }
                }
            };
            request.send(formData);
        });
    </script>

</body>
</html>